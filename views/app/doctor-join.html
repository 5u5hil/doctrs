<ion-view class="rjoin-view" >
    <ion-nav-title>
        <span> {{user[0].fname}} {{user[0].lname}}</span>
    </ion-nav-title>
    <ion-nav-buttons side="right">
        <button class="button button-icon button-clear" ng-click="exitVideo()"> Exit</button>
    </ion-nav-buttons>
    <div class="bar bar-subheader cbar">
        <div class="row">
            <div class="col txt-centre"><h5><a  ui-sref="#">Appointment at {{app[0].appointments.scheduled_start_time|time}}</a></h5></div>
			
			<button class="button flt-right ion-plus" ng-click="addnote();"></button>
        </div>
    </div>
    <ion-content>
        <div class="fltr-mesg"> &nbsp;</div>
        <div class="mediascreen"  >
            <!--<iframe class="videochat" ng-src="{{trustSrc(oToken)}}" ></iframe>-->
            <div id='myPublisherDiv' style="position:absolute;right: 10px;bottom:10px"></div> 
            <div id='subscribersDiv' class="subscribediv">Waiting for patient to join!</div> 
        </div>
    </ion-content>
    <div class="sticyfooter joinfooter">
        <div class="tabs tabs-icon-top">
            <div class="tab-item muteMic" onclick="classtoggle(this)">
				<i class="icon ion-ios-mic"></i>
                <i class="icon ion-ios-mic-off"></i>
                Mic
            </div>
           <!--   <div class="tab-item" onclick="classtoggle(this)" >
                <i class="icon ion-videocamera"></i>
                Video
            </div>
           <a class="tab-item" >
                <i class="icon ion-refresh"></i>
                Switch
            </a>
            <a class="tab-item muteSub" >
                <i class="icon ion-volume-low"></i>
                Valume
            </a> -->
        </div>
    </div>
	



<div class="slideupdiv">
<div class="item item-divider">Consultation Note</div>
    <div class="slideupcontent">
	<ion-list>
			<div class="row">
				<div class="col cradio">
				<ion-radio ng-model="casetype" name="{{field.name}}" ng-value="'1'"  value="1" ng-change="getCase(casetype)" required>New Case</ion-radio>
				</div>
				<div class="col cradio"> <ion-radio ng-model="casetype" name="{{field.name}}" ng-value="'0'" value="0" ng-change="getCase(casetype)" required>Ongoing Case</ion-radio></div>
			</div>
		</ion-list>
		
	<label class="item item-input" id="newcase">
		<input type="text" placeholder="Case" name="new-{{field.name}}" ng-model="formCase" >
	</label>
	<div class="mt15">
	<div class="row tabnav bgwhite">
	<div class="col brdrht"><a class="nbtn ion-image" > Images</a></div>
	<div class="col brdrht"><div class="nbtn ion-medkit" onclick="showpopup('selectnote')"> Notes</div></div>
	<div class="col"><div class="nbtn ion-thermometer" ng-controller="docjnPatientCtrl" ng-click="modal.show();"> Treatment Plan</div></div>
	</div>
	</div>
	</div>
    </div>

    <div class="ciframecontainer">
        <iframe src="#/app/consultations-note"></iframe>
    </div>




</ion-view>


<div class="custpopup-container" id="selectnote">
<div class="custpopup">
<div class="ncbtn" onclick="close_popup('selectnote')"><i class="ion-close"></i></div>
   <h3 class="heading3">Background</h3>
    <div class="row cbtn3">
    <div class="col">
    <div class="Cstmbutn button-small" ng-controller="docjnPatientCtrl" ng-click="modal.show();"><span class="icon ion-plus-circled"></span>  Patient</div> 
    </div>
 <div class="col">
    <div class="Cstmbutn button-small" ng-click="modalclose('app.family-history')"><span class="icon ion-plus-circled"></span>  Family</div> 
    </div>
    </div>
  <h3 class="heading3">Evaluation</h3>
     <div class="row cbtn3">
    <div class="col">
    <div class="Cstmbutn button-small" ng-click="modalclose('app.measurement')"><span class="icon ion-plus-circled"></span> Measurements</div> 
    </div>

    <div class="col">
    <div class="Cstmbutn button-small" ng-click="modalclose('app.testresult')"> <span class="icon ion-plus-circled"></span> Test Results</div> 
    </div>
    </div>  

    <div class="row cbtn3">
    <div class="col">
    <div class="Cstmbutn button-small" ng-click="modalclose('app.observation')"> <span class="icon ion-plus-circled"></span> Observations</div> 
    </div>
    </div>

     <h3 class="heading3">Diagnosis</h3>
      
    <div class="row cbtn3">
    <div class="col">
    <div class="Cstmbutn button-small" ng-controller="SnowmedtCtrl" ng-click="modal.show()"><span class="icon ion-plus-circled"></span> SNOMED</div> 
    </div>

    <div class="col">
    <div class="Cstmbutn button-small" ng-controller="IcdCtrl" ng-click="modal.show()"><span class="icon ion-plus-circled"></span> ICD</div> 
    </div>
    </div>       

    <div class="row cbtn3">
    <div class="col">
    <div class="Cstmbutn button-small" ng-controller="PlaintestCtrl" ng-click="modal.show()"> <span class="icon ion-plus-circled"></span> Text</div> 
    </div>
    </div>
</div>
</div>


<script id="docjn-patient" type="text/ng-template">
    <ion-modal-view>
    <ion-header-bar class="bar app-top-bar">
    <h1 class="title">Patient</h1>   

    </ion-header-bar>
    <ion-content>

     <div class="" >
                <input type="hidden" ng-model="record.recordUser" value="{{userId}}" name="userId" />
                <input type="hidden" value="Patient History" name="rectype" />
                <input type="hidden" ng-model="record.recordPatient" value="{{patientId}}" name="patient" />
                <input type="hidden" ng-model="record.recordPatient" value="{{doctorId}}" name="doctor" />
                <input type="hidden" ng-model="record.recordCat" value="{{record.id}}" name="recordCat" />
                <div ng-if="abt.length != 0">
                    <input type="hidden" value="{{abt[0].record_id}}" name="patRecId" />
                </div>
                <div class="item item-divider">Contact Information</div>
                <div ng-repeat="field in fields">
                    <label class="item item-input hide" ng-if="field.field == 'Doctor'">
                        <input type="hidden" ng-model="doctorId" name="{{field.name}}"  value="{{doctorId}}">
                    </label>
                    <label class="item item-input hide" ng-if="field.field == 'Patient'">
                        <input type="hidden" ng-model="patientId" value="{{patientId}}" name="{{field.name}}" />
                    </label>
                    <div ng-if="field.field == 'Mobile Number'">
                        <div ng-if="abt.length != 0">
                            <div ng-repeat="ab in abt">
                                <div ng-if="ab.fields.field == 'Mobile Number'">
                                    <label class="item item-input" ng-if="ab.value != ''">
                                        <span class="input-label">{{field.field}}</span>
                                        <input type="tel" name="{{field.name}}"  value="{{ab.value}}">
                                    </label>
                                    <label class="item item-input" ng-if="ab.value == ''">
                                        <span class="input-label">{{field.field}}</span>
                                        <input type="tel" name="{{field.name}}" value="{{patients[0].phone}}">
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div ng-if="abt.length == 0">
                            <label class="item item-input" ng-if="patients[0].phone != ''">
                                <span class="input-label">{{field.field}}</span>
                                <input type="tel" name="{{field.name}}"  value="{{patients[0].phone}}">
                            </label>
                            <label class="item item-input" ng-if="patients[0].phone == ''">
                                <span class="input-label">{{field.field}}</span>
                                <input type="tel" name="{{field.name}}" >
                            </label>
                        </div>
                    </div>
                    <div ng-if="field.field == 'Email'">
                        <div ng-if="abt.length != 0">
                            <div ng-repeat="ab in abt">
                                <div ng-if="ab.fields.field == 'Email'">
                                    <label class="item item-input" ng-if="ab.value != ''">
                                        <span class="input-label">{{field.field}}</span>
                                        <input type="email" name="{{field.name}}" value="{{ab.value}}">
                                    </label>
                                    <label class="item item-input" ng-if="ab.value == ''">
                                        <span class="input-label">{{field.field}}</span>
                                        <input type="email" name="{{field.name}}" value="{{patients[0].email}}" >
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div ng-if="abt.length == 0">
                            <label class="item item-input" ng-if="patients[0].email != ''">
                                <span class="input-label">{{field.field}}</span>
                                <input type="email" name="{{field.name}}" value="{{patients[0].email}}">
                            </label>
                            <label class="item item-input" ng-if="patients[0].email == ''">
                                <span class="input-label">{{field.field}}</span>
                                <input type="email" name="{{field.name}}" >
                            </label>
                        </div>
                    </div>
                </div>
                <div class="item item-divider" >Basic Information</div>
                <div ng-repeat="field in fields">

                    <div ng-if="field.field_types.value == 'date'">
                        <div ng-if="abt.length != 0">
                            <div ng-repeat="ab in abt">
                                <div ng-if="ab.fields.field == 'Date of Birth'">
                                    <label class="item item-input">
                                        <span class="input-label">{{field.field}}</span>
                                        <input type="date" name="{{field.name}}" ng-model="dob" placeholder="{{field.field}}" value="{{dob|dateFormat1}}">
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div ng-if="abt.length == 0">
                            <label class="item item-input">
                                <span class="input-label">{{field.field}}</span>
                                <input type="date" name="{{field.name}}" ng-model="curTime" placeholder="{{field.field}}" value="{{curTime|dateFormat1}}">
                            </label>
                        </div>
                    </div>
                    <div ng-if="field.field_types.value == 'radio'">
                        <div ng-if="abt.length != 0">
                            <div ng-repeat="ab in abt">
                                <div ng-if="ab.fields.field == 'Gender'">
                                    <ion-list>
                                        <div class="row" ng-init="radioData = (field.field_values).split(',')" ng-model="radioData"> 
                                            <div class="col"><span class="input-label" style="padding: 7px 10px 7px 7px;">{{field.field}}</span></div>
                                            <div class="col cradio" ng-repeat="rad in radioData">
                                                <ion-radio ng-model="gen[rad]"  name="{{field.name}}" value="{{rad}}" ng-checked="rad == ab.value" ng-value="{{rad}}" >{{rad}} </ion-radio>
                                            </div>
                                        </div>
                                    </ion-list>
                                </div>
                            </div>
                        </div>
                        <div ng-if="abt.length == 0">
                            <ion-list>
                                <div class="row" ng-init="radioData = (field.field_values).split(',')" ng-model="radioData"> 
                                    <div class="col"><span class="input-label" style="padding: 7px 10px 7px 7px;">{{field.field}}</span></div>
                                    <div class="col cradio" ng-repeat="rad in radioData"><ion-radio  name="{{field.name}}" value="{{rad}}" >{{rad}}</ion-radio></div>
                                </div>
                            </ion-list>
                        </div>
                    </div>
                    <div ng-if="field.field_types.value == 'select'">
                        <div ng-if="abt.length != 0">
                            <div ng-repeat="ab in abt">
                                <div ng-if="ab.fields.field == 'Blood Group'">
                                    <label class="item item-input item-select">
                                        <div class="input-label">{{field.field}}</div>
                                        <select class="cselect" ng-model="blood" ng-init="selData = (field.field_values).split(',')" name="{{field.name}}">
                                            <option value="0" ng-selected="1"> Select {{field.field}}</option>
                                            <option ng-repeat="sel in selData" value="{{sel}}" ng-selected="sel == ab.value"> {{sel}} </option>
                                        </select>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div ng-if="abt.length == 0">
                            <label class="item item-input item-select">
                                <div class="input-label">{{field.field}}</div>
                                <select class="cselect" ng-init="selData = (field.field_values).split(',')" name="{{field.name}}">
                                    <option value="0" ng-selected="1"> Select {{field.field}}</option>
                                    <option ng-repeat="sel in selData" value="{{sel}}"> {{sel}} </option>
                                </select>
                            </label>
                        </div>
                    </div>
                    <div ng-if="field.field_types.value == 'text'">
                        <label class="item item-input" ng-if="field.field != 'Patient' && field.field != 'Doctor' && field.field != 'Email' && field.field != 'Mobile Number'"> <div class="input-label">{{field.field}}</div>
                            <input type="text" placeholder="{{field.field}}" id="{{field.name}}" class="toClone"  name="{{field.name}}" />                                
                        </label>
                    </div>
                    <div ng-if="field.field_types.value == 'number'">
                        <label class="item item-input" ng-if="field.field != 'Patient' && field.field != 'Doctor' && field.field != 'Email' && field.field != 'Mobile Number'"> <div class="input-label">{{field.field}}</div>
                            <input type="number" placeholder="{{field.field}}" id="{{field.name}}" class="toClone"  name="{{field.name}}" />                                
                        </label>
                    </div>
                    <div ng-if="field.field_types.value == 'textarea'">
                        <label class="item item-input"> <div class="input-label">{{field.field}}</div>
                            <textarea type="text" placeholder="{{field.field}}" id="{{field.name}}" class="toClone"  name="{{field.name}}" ></textarea>                                
                        </label>
                    </div>
                </div>
                <div class="item item-divider">Known Conditions
                    <button class="Cstmbutn button-small mb15 col-25" style="float:right; padding:0;" ng-controller="knowConditionCtrl" ng-click="modal.show()"><span class="icon ion-plus-circled"></span> Add </button>
                </div>
                <div class="knowcondition">
                    <input type="hidden" ng-model="conIds" id="selcon" value="" name="conditions" />
                    <ul><li ng-repeat="sel in selConditions">{{sel.condition}}</li></ul>
                </div>
                <div class="flexcont">
                    <div class="innerdiv col-50 brdright">
                        <div class="item item-divider">Allergies</div>
                        <div class="p10">
                            <button  class="Cstmbutn button-small mb15" ng-click="modal.show()"><span class="icon ion-plus-circled"></span> Add</button>
                            <!-- <div class="custombtn" ng-click="gotopage('app.patient-history')">Patient</div>  -->
                        </div>
                    </div>
                    <div class="innerdiv col-50">
                        <div class="item item-divider">Vaccinations</div>
                        <div class="p10">
                            <button class="Cstmbutn button-small mb15" ng-click="modal.show()"><span class="icon ion-plus-circled"></span> Add </button>    
                        </div>
                    </div>
                </div>
            </div>

    </ion-content>
    <div class="fixedbar">
    <div class="button btn-delete" nav-clear ng-click="modal.hide()" ><i class="ion-close"></i> Cancel</div>
    <div class="button btn-add" ng-click="submitmodal()"><i class="ion-checkmark"></i> Save</div>
    </div>
    </ion-modal-view>
</script>

